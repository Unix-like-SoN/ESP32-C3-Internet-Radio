[env:esp32-c3-devkitm-1]
platform = espressif32
board = esp32-c3-devkitm-1
framework = arduino
upload_port = /dev/ttyACM0
monitor_port = /dev/ttyACM0
monitor_speed = 115200
upload_speed = 921600

lib_deps = 
    earlephilhower/ESP8266Audio
    adafruit/Adafruit SSD1306 @ ^2.5.9
    adafruit/Adafruit GFX Library @ ^1.11.9
    bblanchon/ArduinoJson @ ^7.0.4
    esphome/ESPAsyncWebServer-esphome @ ^3.2.2
    esphome/AsyncTCP-esphome @ ^2.1.3

build_flags = 
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DARDUINO_USB_MODE=1
    -DCORE_DEBUG_LEVEL=3
    -O2
    -DCONFIG_ASYNC_TCP_USE_WDT=0
    ; IRAM оптимизация
    -DBOARD_HAS_PSRAM=0
    ; Веб-сервер оптимизация
    -DCONFIG_ASYNC_TCP_RUNNING_CORE=0
    -DCONFIG_ASYNC_TCP_MAX_ACK_TIME=3000
    -DCONFIG_ASYNC_TCP_PRIORITY=5
    -DCONFIG_ASYNC_TCP_QUEUE_SIZE=128
    ; === BROWN-OUT DETECTOR (защита от просадки напряжения) ===
    ; Уровень срабатывания: 2.51V (безопасно для 3.3V питания)
    ; Доступные уровни: 2.43V, 2.51V, 2.58V, 2.66V, 2.74V, 2.80V, 2.88V, 2.95V
    -DCONFIG_ESP_BROWNOUT_DET=1
    -DCONFIG_ESP_BROWNOUT_DET_LVL=7

board_build.filesystem = littlefs
board_build.partitions = partitions.csv

; === ОПТИМИЗАЦИЯ ПРОИЗВОДИТЕЛЬНОСТИ ===
; Flash на 80 МГц в режиме QOUT (быстро + надежно)
board_build.f_flash = 80000000L
board_build.flash_mode = qout

; CPU на 160 МГц (максимальная производительность)
board_build.f_cpu = 160000000L
